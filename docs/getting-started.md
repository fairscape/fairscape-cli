## RO-Crate

The interface uses the `fairscape-cli` root command to invoke all sub-commands.

### Create a new RO-Crate

All RO-Crate operations are invoked using the `rocrate` sub-command. Creation of an RO-Crate is performed by the `create` sub-command. It uses one optional parameter `guid`, three required parameters `name`, `organization-name`, `project-name`, and a location on the disk `ROCRATE_PATH`  

``` bash
fairscape-cli rocrate create [OPTIONS] ROCRATE_PATH

Options:
  --guid TEXT
  --name TEXT               [required]
  --description TEXT        [required]
  --keywords TEXT           [required]
  --organization-name TEXT  [required]
  --project-name TEXT       [required]
```

The following command will create a new RO-Crate instance with a minimal set of metadata. A file `ro-crate-metadata.json` is created in the `ROCRATE_PATH` that contains the metadata. A unique identifier is generated automatically to represent the RO-Crate. 

``` bash 
fairscape-cli rocrate create \
  --name "test rocrate" \
  --description "Example RO Crate for Tests" \
  --keywords "b2ai" \
  --keywords "cm4ai" \
  --keywords "U2OS" \
  --organization-name "UVA" \
  --project-name "B2AI"  \
  "/home/user/test_rocrate"
```

For a given identifier, the option `guid` is used. 

``` bash
fairscape-cli rocrate create \
  --guid "ark:5982/UVA/B2AI/test_rocrate" \
  --name "test rocrate" \
  --description "Example RO Crate for Tests" \
  --keywords "b2ai" \
  --keywords "cm4ai" \
  --keywords "U2OS" \
  --organization-name "UVA" \
  --project-name "B2AI"  \
  "/home/user/test_rocrate"
```

### Add objects to RO-Crate

The FAIRSCAPE ecosystem treats datasets and software as objects. Adding objects to an RO-Crate is performed by the `add` sub-command. Whenever the `add` command is used, the object is fetched and added to the crate.

``` bash
fairscape-cli rocrate add [OPTIONS] COMMAND [ARGS]...

Options:
  --help  Show this message and exit.

Commands:
  dataset
  software
```
#### Add dataset object

The sub-command `dataset` is used to add a dataset. It uses eight required parameters `name`, `author`, `version`, `date-published`, `description`, `data-format`, `source-filepath`, and `destination-filepath`. The additional six parameters are optional. Metadata about the dataset are added to the `ro-crate-metadata.json` and the dataset object is copied to the location `ROCRATE_PATH`. 

``` bash
fairscape-cli rocrate add dataset [OPTIONS] ROCRATE_PATH

Options:
  --guid TEXT
  --name TEXT                     [required]
  --url TEXT
  --author TEXT                   [required]
  --version TEXT                  [required]
  --date-published TEXT           [required]
  --description TEXT              [required]
  --keywords TEXT                 [required]
  --data-format TEXT              [required]
  --source-filepath TEXT          [required]
  --destination-filepath TEXT     [required]
  --used-by TEXT
  --derived-from TEXT
  --associated-publication TEXT
  --additional-documentation TEXT
```

The `add dataset` sub-command below uses the required options to add a dataset object to the crate and populate the associated metadata within the metadata file `ro-crate-metadata.json`. A unique identifier is generated automatically to represent the dataset. 

``` bash 
fairscape-cli rocrate add dataset \
  --name "AP-MS embeddings" \
  --author "Gygi lab (https://gygi.hms.harvard.edu/team.html)" \
  --version "1.0" \
  --date-published "2021-04-23" \
  --description "Affinity purification mass spectrometer (APMS) embeddings for each protein in the study,  generated by node2vec predict." \
  --keywords "b2ai" \
  --keywords "cm4ai" \
  --keywords "U2OS" \
  --data-format "CSV" \
  --source-filepath "./tests/data/APMS_embedding_MUSIC.csv" \
  --destination-filepath "/home/user/test_rocrate" \
  "/home/user/test_rocrate"
```

The following command performs the same operation using both required and optional parameters:

``` bash
fairscape-cli rocrate add dataset \
  --guid "ark:5982/UVA/B2AI/example_rocrate/AP-MS_embeddings-Dataset" \
  --name "AP-MS embeddings" \
  --url "https://github.com/idekerlab/MuSIC/blob/master/Examples/APMS_embedding.MuSIC.csv" \
  --author "Gygi lab (https://gygi.hms.harvard.edu/team.html)" \
  --version "1.0" \
  --date-published "2021-04-23" \
  --description "Affinity purification mass spectrometer (APMS) embeddings for each protein in the study,  generated by node2vec predict." \
  --keywords "b2ai" \
  --keywords "cm4ai" \
  --keywords "U2OS" \
  --data-format "CSV" \
  --source-filepath "./tests/data/APMS_embedding_MUSIC.csv" \
  --destination-filepath "/home/user/test_rocrate" \
  --used-by "create labeled training & test sets  random_forest_samples.py" \
  --derived-from "node2vec predict" \
  --associated-publication "Qin, Y. et al. A multi-scale map of cell structure fusing protein images and interactions" \
  --additional-documentation "https://idekerlab.ucsd.edu/music/" \
  "/home/user/test_rocrate"
```

`fairscape-cli` offers an option to annotate certain types of datasets with schema-level metadata. The page 
[Schema Metadata](schema-metadata.md) demonstrates how the CLI can be used to generate the schema metadata for a dataset.

#### Add software object

The sub-command `software` is used to add a software. It uses eight required parameters `name`, `author`, `version`, `description`, `file-format`, `source-filepath`, `destination-filepath`, and `date-modified`. The additional five parameters are optional. Metadata about the software are added to the `ro-crate-metadata.json` and the software object is copied to the location `ROCRATE_PATH`. 

``` bash
fairscape-cli rocrate add software [OPTIONS] ROCRATE_PATH

Options:
  --guid TEXT
  --name TEXT                     [required]
  --author TEXT                   [required]
  --version TEXT                  [required]
  --description TEXT              [required]
  --keywords TEXT                 [required]
  --file-format TEXT              [required]
  --url TEXT
  --source-filepath TEXT          [required]
  --destination-filepath TEXT     [required]
  --date-modified TEXT            [required]
  --used-by-computation TEXT
  --associated-publication TEXT
  --additional-documentation TEXT
```

The `add software` sub-command below uses the required options to add a software object to the crate and populate the associated metadata within the metadata file `ro-crate-metadata.json`. A unique identifier is generated automatically to represent the software. 

``` bash
fairscape-cli rocrate add software \
  --name "calibrate pairwise distance" \
  --author "Qin, Y." \
  --version "1.0" \
  --description "script written in python to calibrate pairwise distance." \
  --keywords "b2ai" \
  --keywords "cm4ai" \
  --keywords "U2OS" \
  --file-format "py" \
  --source-filepath "./tests/data/calibrate_pairwise_distance.py" \
  --destination-filepath "/home/user/test_rocrate" \
  --date-modified "2021-04-23" \
  "/home/user/test_rocrate"
```

The following command performs the same operation using both required and optional parameters:

``` bash
fairscape-cli rocrate add software \
  --guid "ark:5982/UVA/B2AI/example_rocrate/calibrate_pairwise_distance-Software" \
  --name "calibrate pairwise distance" \
  --author "Qin, Y." \
  --version "1.0" \
  --description "Affinity purification mass spectrometer (APMS) embeddings for each protein in the study,  generated by node2vec predict." \
  --keywords "b2ai" \
  --keywords "U2OS" \
  --file-format "py" \
  --url "https://github.com/idekerlab/MuSIC/blob/master/calibrate_pairwise_distance.py" \
  --source-filepath "./tests/data/calibrate_pairwise_distance.py" \
  --destination-filepath "/home/user/test_rocrate" \
  --date-modified "2021-06-20" \
  --used-by-computation "ARK:compute_standard_proximities.1/f9aa5f3f-665a-4ab9-8879-8d0d52f05265" \
  --associated-publication "Qin, Y. et al. A multi-scale map of cell structure fusing protein images and interactions. Nature 600, 536–542 2021" \
  --additional-documentation "https://idekerlab.ucsd.edu/music/" \
  "/home/user/test_rocrate"
```

### Register metadata to RO-Crate
The sub-command `register` is used to add metadata of the components of an RO-Crate to `ro-crate-metadata.json`. Registration can be performed on instances of four components: `computation`, `dataset`, `dataset-container`, and `software`. 

The sub-commands `add dataset` and `add software` described above issue implicit calls to methods that register metadata about the dataset and software, respectively.

The following command shows the sub-commands for registering each component:

``` bash 
fairscape-cli rocrate register [OPTIONS] COMMAND [ARGS]...

Options:
  --help  Show this message and exit.

Commands:
  computation
  dataset
  dataset-container  Add a DatasetContainer to the ROCrate.
  softwares
```

#### Register computation metadata
The FAIRSCAPE ecosystem treats computation as an activity. Unlike datasets and software which are objects, computations need not be added to the crate. Computations, however, are required to be registered within the RO-Crate metadata. 

Registration of computation is performed by the `register computation` sub-command. It uses four required parameters `name`, `run-by`, `date-created`, and `description`. The additional five parameters are optional. Whenever this command is used metadata about the computation is added to `ro-crate-metadata.json` located in `ROCRATE_PATH`.

The following command shows all options and arguments for registering metadata about the computation.

``` bash
fairscape-cli rocrate register computation [OPTIONS] ROCRATE_PATH

Options:
  --guid TEXT
  --name TEXT           [required]
  --run-by TEXT         [required]
  --command TEXT
  --date-created TEXT   [required]
  --description TEXT    [required]
  --keywords TEXT       [required]
  --used-software TEXT
  --used-dataset TEXT
  --generated TEXT
```

The `register computation` sub-command below uses only the required options to populate the metadata of a computation within the metadata file `ro-crate-metadata.json`. A unique identifier is generated automatically to represent the computation. 

``` bash
fairscape-cli rocrate register computation \
  --name "calibrate pairwise distance" \
  --run-by "Qin, Y." \
  --date-created "2021-05-23" \
  --description "Average the predicted proximities" \
  --keywords "b2ai" \
  --keywords "cm4ai" \
  --keywords "U2OS" \
  "/home/user/test_rocrate"
```

The following command performs the same operation using both required and optional parameters:

``` bash
fairscape-cli rocrate register computation \
  --guid "ark:5982/UVA/B2AI/test_rocrate/calibrate_pairwise_distance-Computation" \
  --name "calibrate pairwise distance" \
  --run-by "Qin, Y." \
  --command "some command" \
  --date-created "2021-05-23" \
  --description "Average the predicted proximities" \
  --keywords "b2ai" \
  --keywords "clustering" \
  --used-software "random_forest_output (https://github.com/idekerlab/MuSIC/blob/master/random_forest_output.py)" \
  --used-dataset "IF_emd_1_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_1.pkl" \
  --used-dataset "IF_emd_2_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_1.pkl" \
  --used-dataset "IF_emd_1_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_2.pkl" \
  --used-dataset "IF_emd_2_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_2.pkl" \
  --used-dataset """Fold 1 proximities: IF_emd_1_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_3.pkl""" \
  --used-dataset "IF_emd_2_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_3.pkl" \
  --used-dataset """Fold 1 proximities: IF_emd_1_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_4.pkl""" \
  --used-dataset "IF_emd_2_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_4.pkl" \
  --used-dataset """Fold 1 proximities: IF_emd_1_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_5.pkl""" \
  --used-dataset "IF_emd_2_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_5.pkl" \
  --generated "averages of predicted protein proximities (https://github.com/idekerlab/MuSIC/blob/master/Examples/MuSIC_predicted_proximity.txt)" \
  "/home/user/test_rocrate"
```

#### Register dataset metadata

Registration of dataset is performed by the `register dataset` sub-command. Instead of the `source-filepath` and `destination-filepath` options in the `add dataset` command above, it uses the required option `filepath` that referring to the `source-filepath`. The command is used to add metadata about the dataset to `ro-crate-metadata.json` located in `ROCRATE_PATH`.

The following command shows all options and arguments for registering metadata about the dataset.

``` bash hl_lines="12"
fairscape-cli rocrate register dataset [OPTIONS] ROCRATE_PATH

Options:
  --guid TEXT
  --name TEXT                     [required]
  --url TEXT
  --author TEXT                   [required]
  --version TEXT                  [required]
  --date-published TEXT           [required]
  --description TEXT              [required]
  --keywords TEXT                 [required]
  --data-format TEXT              [required]
  --filepath TEXT                 [required]
  --used-by TEXT
  --derived-from TEXT
  --associated-publication TEXT
  --additional-documentation TEXT
```

The following command adds metadata with required and optional parameters:

``` bash
fairscape-cli rocrate register dataset \
  --guid "ark:5982/UVA/B2AI/example_rocrate/AP-MS_embeddings-Dataset" \
  --name "AP-MS embeddings" \
  --url "https://github.com/idekerlab/MuSIC/blob/master/Examples/APMS_embedding.MuSIC.csv" \
  --author "Gygi lab (https://gygi.hms.harvard.edu/team.html)" \
  --version "1.0" \
  --date-published "2021-04-23" \
  --description "Affinity purification mass spectrometer (APMS) embeddings for each protein in the study,  generated by node2vec predict." \
  --keywords "apms" \
  --keywords "b2ai" \
  --keywords "cm4ai" \
  --data-format "CSV" \
  --filepath "./tests/data/APMS_embedding_MUSIC.csv" \
  --used-by "create labeled training & test sets  random_forest_samples.py" \
  --derived-from "node2vec predict" \
  --associated-publication "Qin, Y. et al. A multi-scale map of cell structure fusing protein images and interactions" \
  --additional-documentation "https://idekerlab.ucsd.edu/music/" \
  "/home/user/test_rocrate"
```

#### Register software metadata

Registration of software is performed by the `register software` sub-command. Instead of the `source-filepath` and `destination-filepath` options in the `add software` command above, it uses the required option `filepath` that referring to the `source-filepath`. The command is used to add metadata about the dataset to `ro-crate-metadata.json` located in `ROCRATE_PATH`.

The following command shows all options and arguments for registering metadata about the dataset.

``` bash hl_lines="12"
fairscape-cli rocrate register software [OPTIONS] ROCRATE_PATH

Options:
  --guid TEXT
  --name TEXT                     [required]
  --author TEXT                   [required]
  --version TEXT                  [required]
  --description TEXT              [required]
  --keywords TEXT                 [required]
  --file-format TEXT              [required]
  --url TEXT
  --date-modified TEXT
  --filepath TEXT
  --used-by-computation TEXT
  --associated-publication TEXT
  --additional-documentation TEXT
```

The following command adds metadata with required and optional parameters:

``` bash
fairscape-cli rocrate register software \
  --guid "ark:5982/UVA/B2AI/example_rocrate/calibrate_pairwise_distance-Software" \
  --name "calibrate pairwise distance" \
  --author "Qin, Y." \
  --version "1.0" \
  --description "Affinity purification mass spectrometer (APMS) embeddings for each protein in the study,  generated by node2vec predict." \
  --file-format "py" \
  --url "https://github.com/idekerlab/MuSIC/blob/master/calibrate_pairwise_distance.py" \
  --filepath "./tests/data/calibrate_pairwise_distance.py" \
  --date-modified "2021-06-20" \
  --used-by-computation "ARK:compute_standard_proximities.1/f9aa5f3f-665a-4ab9-8879-8d0d52f05265" \
  --associated-publication "Qin, Y. et al. A multi-scale map of cell structure fusing protein images and interactions. Nature 600, 536–542 2021" \
  --additional-documentation "https://idekerlab.ucsd.edu/music/" \
  "/home/user/test_rocrate"
```

## BagIt

The CLI supports creating BagIt from an existing RO-Crate. Integration of BagIt with repositories such as [Dataverse](https://guides.dataverse.org/en/5.13/user/dataset-management.html) and [Library of Congress](https://blogs.loc.gov/thesignal/2019/04/bagit-at-the-library-of-congress/) indicates its increasing use as a mechanism for transferring and storing digital content. The structure of a BagIt is simple to understand and the integrity of its contents can be easily validated. There is a clear separation of contents, metadata and checksum values.  

### Structure of a BagIt
A BagIt created by the CLI has the following structure that are described in detail in the [specification](https://datatracker.ietf.org/doc/html/rfc8493). By default, a BagIt created by the CLI contains `bag-info.txt` for metadata, `bag.txt` specifying the version and encoding, three files titled `manifest-[algorithm].txt` for validating digital contents, and three `tagmanifest-[algorithm].txt` files for validating the rest of the files in a `Bag` other than the contents. Each `algorithm` is an instance of the [MD5](https://en.wikipedia.org/wiki/MD5), SHA-256 and SHA-512 [hash algorithms](https://en.wikipedia.org/wiki/SHA-2) for generating checksum.

```
<base directory>/
   |
   +-- bag-info.txt
   |
   +-- bagit.txt
   |
   +-- manifest-md5.txt
   |
   +-- manifest-sha256.txt
   |
   +-- manifest-sha512.txt
   |
   +-- tagmanifest-md5.txt
   |
   +-- tagmanifest-sha256.txt 
   |
   +-- tagmanifest-sha512.txt 
   |
   +-- data/
   |     |
   |     +-- [payload files]
```

### Options and arguments for BagIt creation
Creating a BagIt requires a user to submit information about the metadata, an exising RO-Crate location as `ROCRATE_PATH`, and the target location of the BagIt as `BAGIT_PATH`. The options below list all the six metadata keyword required to create a BagIt.  


``` bash
fairscape-cli rocrate package bagit [OPTIONS] ROCRATE_PATH BAGIT_PATH

Options:
  --Source-Organization TEXT   [required]
  --Organization-Address TEXT  [required]
  --Contact-Name TEXT          [required]
  --Contact-Phone TEXT         [required]
  --Contact-Email TEXT         [required]
  --External-Description TEXT  [required]
```

### Sample command to create a BagIt from a RO-Crate
The following command creates a BagIt in `/home/user/test_bagit` form an existing RO-Crate in `/home/user/test_rocrate`.


``` bash
fairscape-cli rocrate package bagit \
   "/home/user/test_rocrate" \
   "/home/user/test_bagit" \
   --Source-Organization "FOO University" \
   --Organization-Address "1 Main St., Cupertino, California, 11111" \
   --Contact-Name "Jane Doe" \
   --Contact-Phone "+1 111-111-1111" \
   --Contact-Email "example@example.com" \
   --External-Description "Uncompressed greyscale TIFF images from the FOO papers colle..."
```
