
---
## RO-Crate
---

The interface uses the `fairscape-cli` root command to invoke all sub-commands. All RO-Crate operations are invoked using the `rocrate` sub-command.

---

### Create RO-Crate
An RO-Crate can be created either by the `create` or `init` sub-command. While `create` allows users to choose the destination directory using the `ROCRATE_PATH` argument, `init` creates the RO-Crate in the present working directory. Both commands use one optional parameter `guid`, five required parameters `name`, `description`, `keywords`, `organization-name`, and `project-name`.

``` bash
fairscape-cli rocrate create [OPTIONS] ROCRATE_PATH

Options:
  --guid TEXT
  --name TEXT               [required]
  --description TEXT        [required]
  --keywords TEXT           [required]
  --organization-name TEXT  [required]
  --project-name TEXT       [required]
```

The following command will create an RO-Crate with a minimal set of metadata. A file `ro-crate-metadata.json` containing the metadata is created in the path specified as the value of the argument `ROCRATE_PATH`. A unique identifier is generated automatically to represent the RO-Crate. 

``` bash 
fairscape-cli rocrate create \
  --name "test rocrate" \
  --description "Example RO Crate for Tests" \
  --keywords "b2ai" \
  --keywords "cm4ai" \
  --keywords "U2OS" \
  --organization-name "UVA" \
  --project-name "B2AI"  \
  "/path/to/test_rocrate"
```

For a given identifier, the option `guid` is used as follows: 

``` bash
fairscape-cli rocrate create \
  --guid "ark:59852/UVA/B2AI/test_rocrate" \
  --name "test rocrate" \
  --description "Example RO Crate for Tests" \
  --keywords "b2ai" \
  --keywords "cm4ai" \
  --keywords "U2OS" \
  --organization-name "UVA" \
  --project-name "B2AI"  \
  "/path/to/test_rocrate"
```

As as alternative, `fairscape-cli rocrate init` command below creates the same RO-Crate in the present working directory. 

``` bash
fairscape-cli rocrate init \
  --guid "ark:59852/UVA/B2AI/test_rocrate" \
  --name "test rocrate" \
  --description "Example RO Crate for Tests" \
  --keywords "b2ai" \
  --keywords "cm4ai" \
  --keywords "U2OS" \
  --organization-name "UVA" \
  --project-name "B2AI"
```

---

### Add object
The FAIRSCAPE ecosystem treats datasets and software as objects. Adding objects to an RO-Crate is performed by the `add` sub-command. Whenever the `add` command is used, the object is fetched and transferred to the crate.

``` bash
Usage: fairscape-cli rocrate add [OPTIONS] COMMAND [ARGS]...

  Add (transfer) object to RO-Crate and register object metadata.

Options:
  --help  Show this message and exit.

Commands:
  dataset   Add Dataset object and metadata.
  software  Add Software object and metadata.
```

---

#### Dataset object
The sub-command `dataset` is used to add a dataset. It uses eight required parameters `name`, `author`, `version`, `date-published`, `description`, `data-format`, `source-filepath`, and `destination-filepath`. The additional six parameters are optional. Metadata about the dataset are added to the `ro-crate-metadata.json` and the dataset object is transferred to the location specified by `ROCRATE_PATH`. 

``` bash
fairscape-cli rocrate add dataset [OPTIONS] ROCRATE_PATH

Options:
  --guid TEXT
  --name TEXT                     [required]
  --url TEXT
  --author TEXT                   [required]
  --version TEXT                  [required]
  --date-published TEXT           [required]
  --description TEXT              [required]
  --keywords TEXT                 [required]
  --data-format TEXT              [required]
  --source-filepath TEXT          [required]
  --destination-filepath TEXT     [required]
  --used-by TEXT
  --derived-from TEXT
  --associated-publication TEXT
  --additional-documentation TEXT
```

The `add dataset` sub-command below uses the required options to add a dataset object to the crate and populate the associated metadata within the metadata file `ro-crate-metadata.json`. A unique identifier is generated automatically to represent the dataset. 

``` bash 
fairscape-cli rocrate add dataset \
  --name "AP-MS embeddings" \
  --author "Gygi lab (https://gygi.hms.harvard.edu/team.html)" \
  --version "1.0" \
  --date-published "2021-04-23" \
  --description "Affinity purification mass spectrometer (APMS) embeddings for each protein in the study,  generated by node2vec predict." \
  --keywords "b2ai" \
  --keywords "cm4ai" \
  --keywords "U2OS" \
  --data-format "CSV" \
  --source-filepath "./tests/data/APMS_embedding_MUSIC.csv" \
  --destination-filepath "/path/to/test_rocrate" \
  "/path/to/test_rocrate"
```

The following command performs the same operation using both required and optional parameters:

``` bash
fairscape-cli rocrate add dataset \
  --guid "ark:5982/UVA/B2AI/example_rocrate/AP-MS_embeddings-Dataset" \
  --name "AP-MS embeddings" \
  --url "https://github.com/idekerlab/MuSIC/blob/master/Examples/APMS_embedding.MuSIC.csv" \
  --author "Gygi lab (https://gygi.hms.harvard.edu/team.html)" \
  --version "1.0" \
  --date-published "2021-04-23" \
  --description "Affinity purification mass spectrometer (APMS) embeddings for each protein in the study,  generated by node2vec predict." \
  --keywords "b2ai" \
  --keywords "cm4ai" \
  --keywords "U2OS" \
  --data-format "CSV" \
  --source-filepath "./tests/data/APMS_embedding_MUSIC.csv" \
  --destination-filepath "/path/to/test_rocrate" \
  --used-by "create labeled training & test sets  random_forest_samples.py" \
  --derived-from "node2vec predict" \
  --associated-publication "Qin, Y. et al. A multi-scale map of cell structure fusing protein images and interactions" \
  --additional-documentation "https://idekerlab.ucsd.edu/music/" \
  "/path/to/test_rocrate"
```

`fairscape-cli` offers a feature to annotate certain types of dataset objects with schema-level metadata. The examples in  
[Schema Metadata](schema-metadata.md) illustrate how to describe schema of a dataset object as metadata. A mechanism to validate the metadata against the object is a part of this feature.

---

#### Software object
The sub-command `software` is used to add a software object. It uses eight required parameters `name`, `author`, `version`, `description`, `file-format`, `source-filepath`, `destination-filepath`, and `date-modified`. The additional five parameters are optional. Metadata about the software are added to the `ro-crate-metadata.json` and the software object is transferred to the location specified by `ROCRATE_PATH`. 

``` bash
fairscape-cli rocrate add software [OPTIONS] ROCRATE_PATH

Options:
  --guid TEXT
  --name TEXT                     [required]
  --author TEXT                   [required]
  --version TEXT                  [required]
  --description TEXT              [required]
  --keywords TEXT                 [required]
  --file-format TEXT              [required]
  --url TEXT
  --source-filepath TEXT          [required]
  --destination-filepath TEXT     [required]
  --date-modified TEXT            [required]
  --used-by-computation TEXT
  --associated-publication TEXT
  --additional-documentation TEXT
```

The `add software` sub-command below uses the required options to add a software object to the crate and populate the associated metadata within the metadata file `ro-crate-metadata.json`. A unique identifier is generated automatically to represent the software. 

``` bash
fairscape-cli rocrate add software \
  --name "calibrate pairwise distance" \
  --author "Qin, Y." \
  --version "1.0" \
  --description "script written in python to calibrate pairwise distance." \
  --keywords "b2ai" \
  --keywords "cm4ai" \
  --keywords "U2OS" \
  --file-format "py" \
  --source-filepath "./tests/data/calibrate_pairwise_distance.py" \
  --destination-filepath "/path/to/test_rocrate" \
  --date-modified "2021-04-23" \
  "/path/to/test_rocrate"
```

The following command performs the same operation using both required and optional parameters:

``` bash
fairscape-cli rocrate add software \
  --guid "ark:5982/UVA/B2AI/example_rocrate/calibrate_pairwise_distance-Software" \
  --name "calibrate pairwise distance" \
  --author "Qin, Y." \
  --version "1.0" \
  --description "Affinity purification mass spectrometer (APMS) embeddings for each protein in the study,  generated by node2vec predict." \
  --keywords "b2ai" \
  --keywords "U2OS" \
  --file-format "py" \
  --url "https://github.com/idekerlab/MuSIC/blob/master/calibrate_pairwise_distance.py" \
  --source-filepath "./tests/data/calibrate_pairwise_distance.py" \
  --destination-filepath "/path/to/test_rocrate" \
  --date-modified "2021-06-20" \
  --used-by-computation "ARK:compute_standard_proximities.1/f9aa5f3f-665a-4ab9-8879-8d0d52f05265" \
  --associated-publication "Qin, Y. et al. A multi-scale map of cell structure fusing protein images and interactions. Nature 600, 536–542 2021" \
  --additional-documentation "https://idekerlab.ucsd.edu/music/" \
  "/path/to/test_rocrate"
```

---

### Register object metadata
The sub-command `register` is used to add metadata of the components of an RO-Crate to `ro-crate-metadata.json`. Registration can be performed on instances of: `computation`, `dataset`, and `software`. 

The sub-commands `add dataset` and `add software` described above issue implicit calls to methods that register metadata about the dataset and software, respectively.

The following command shows the sub-commands for registering each component:

``` bash 
fairscape-cli rocrate register [OPTIONS] COMMAND [ARGS]...

Options:
  --help  Show this message and exit.

Commands:
  computation
  dataset
  dataset-container  Add a DatasetContainer to the ROCrate.
  softwares
```

---

#### Computation metadata
The FAIRSCAPE ecosystem considers computation as an activity, unlike datasets and software that are treated as objects. To register a computation, it must be added to the RO-Crate metadata using the `register computation` sub-command. This command requires five mandatory parameters: `name`, `run-by`, `date-created`, `description`, and `keywords`. There are also five optional parameters that can be included. 

Once the command is executed, metadata about the computation is added to the `ro-crate-metadata.json` file located in `ROCRATE_PATH`. To view all available options and arguments for registering metadata about the computation, execute the following command.

``` bash
fairscape-cli rocrate register computation [OPTIONS] ROCRATE_PATH

Options:
  --guid TEXT
  --name TEXT           [required]
  --run-by TEXT         [required]
  --command TEXT
  --date-created TEXT   [required]
  --description TEXT    [required]
  --keywords TEXT       [required]
  --used-software TEXT
  --used-dataset TEXT
  --generated TEXT
```

The following `register computation` sub-command is designed to populate the metadata of a computation within the `ro-crate-metadata.json` file using only the necessary options. Additionally, a unique identifier is generated automatically to represent the computation. 

``` bash
fairscape-cli rocrate register computation \
  --name "calibrate pairwise distance" \
  --run-by "Qin, Y." \
  --date-created "2021-05-23" \
  --description "Average the predicted proximities" \
  --keywords "b2ai" \
  --keywords "cm4ai" \
  --keywords "U2OS" \
  "/path/to/test_rocrate"
```

Execute the following command to use all available options and argument for registering a computation: 

``` bash
fairscape-cli rocrate register computation \
  --guid "ark:5982/UVA/B2AI/test_rocrate/calibrate_pairwise_distance-Computation" \
  --name "calibrate pairwise distance" \
  --run-by "Qin, Y." \
  --command "some command" \
  --date-created "2021-05-23" \
  --description "Average the predicted proximities" \
  --keywords "b2ai" \
  --keywords "clustering" \
  --used-software "random_forest_output (https://github.com/idekerlab/MuSIC/blob/master/random_forest_output.py)" \
  --used-dataset "IF_emd_1_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_1.pkl" \
  --used-dataset "IF_emd_2_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_1.pkl" \
  --used-dataset "IF_emd_1_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_2.pkl" \
  --used-dataset "IF_emd_2_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_2.pkl" \
  --used-dataset """Fold 1 proximities: IF_emd_1_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_3.pkl""" \
  --used-dataset "IF_emd_2_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_3.pkl" \
  --used-dataset """Fold 1 proximities: IF_emd_1_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_4.pkl""" \
  --used-dataset "IF_emd_2_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_4.pkl" \
  --used-dataset """Fold 1 proximities: IF_emd_1_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_5.pkl""" \
  --used-dataset "IF_emd_2_APMS_emd_1.RF_maxDep_30_nEst_1000.fold_5.pkl" \
  --generated "averages of predicted protein proximities (https://github.com/idekerlab/MuSIC/blob/master/Examples/MuSIC_predicted_proximity.txt)" \
  "/path/to/test_rocrate"
```

---

#### Dataset metadata
To register a dataset, you can use the `register dataset` sub-command, which requires the `filepath` option to specify the source file path. This command adds metadata about the dataset to the `ro-crate-metadata.json` file in the `ROCRATE_PATH` directory.

To view all available options and arguments for registering metadata about the computation, execute the following command.

``` bash hl_lines="12"
fairscape-cli rocrate register dataset [OPTIONS] ROCRATE_PATH

Options:
  --guid TEXT
  --name TEXT                     [required]
  --url TEXT
  --author TEXT                   [required]
  --version TEXT                  [required]
  --date-published TEXT           [required]
  --description TEXT              [required]
  --keywords TEXT                 [required]
  --data-format TEXT              [required]
  --filepath TEXT                 [required]
  --used-by TEXT
  --derived-from TEXT
  --associated-publication TEXT
  --additional-documentation TEXT
```

Execute the following command to use all available options and argument for registering a dataset:

``` bash
fairscape-cli rocrate register dataset \
  --guid "ark:5982/UVA/B2AI/example_rocrate/AP-MS_embeddings-Dataset" \
  --name "AP-MS embeddings" \
  --url "https://github.com/idekerlab/MuSIC/blob/master/Examples/APMS_embedding.MuSIC.csv" \
  --author "Gygi lab (https://gygi.hms.harvard.edu/team.html)" \
  --version "1.0" \
  --date-published "2021-04-23" \
  --description "Affinity purification mass spectrometer (APMS) embeddings for each protein in the study,  generated by node2vec predict." \
  --keywords "apms" \
  --keywords "b2ai" \
  --keywords "cm4ai" \
  --data-format "CSV" \
  --filepath "./tests/data/APMS_embedding_MUSIC.csv" \
  --used-by "create labeled training & test sets  random_forest_samples.py" \
  --derived-from "node2vec predict" \
  --associated-publication "Qin, Y. et al. A multi-scale map of cell structure fusing protein images and interactions" \
  --additional-documentation "https://idekerlab.ucsd.edu/music/" \
  "/path/to/test_rocrate"
```

---

#### Software metadata
Similarly, to register software, you can use the `register software` sub-command, which also requires the `filepath` option to specify the source file path. This command adds metadata about the software to the same `ro-crate-metadata.json` file in the `ROCRATE_PATH` directory. 

To view all available options and arguments for registering metadata about the computation, execute the following command.

``` bash hl_lines="12"
fairscape-cli rocrate register software [OPTIONS] ROCRATE_PATH

Options:
  --guid TEXT
  --name TEXT                     [required]
  --author TEXT                   [required]
  --version TEXT                  [required]
  --description TEXT              [required]
  --keywords TEXT                 [required]
  --file-format TEXT              [required]
  --url TEXT
  --date-modified TEXT
  --filepath TEXT
  --used-by-computation TEXT
  --associated-publication TEXT
  --additional-documentation TEXT
```

Execute the following command to use all available options and argument for registering a software:

``` bash
fairscape-cli rocrate register software \
  --guid "ark:5982/UVA/B2AI/example_rocrate/calibrate_pairwise_distance-Software" \
  --name "calibrate pairwise distance" \
  --author "Qin, Y." \
  --version "1.0" \
  --description "Affinity purification mass spectrometer (APMS) embeddings for each protein in the study,  generated by node2vec predict." \
  --file-format "py" \
  --url "https://github.com/idekerlab/MuSIC/blob/master/calibrate_pairwise_distance.py" \
  --filepath "./tests/data/calibrate_pairwise_distance.py" \
  --date-modified "2021-06-20" \
  --used-by-computation "ARK:compute_standard_proximities.1/f9aa5f3f-665a-4ab9-8879-8d0d52f05265" \
  --associated-publication "Qin, Y. et al. A multi-scale map of cell structure fusing protein images and interactions. Nature 600, 536–542 2021" \
  --additional-documentation "https://idekerlab.ucsd.edu/music/" \
  "/path/to/test_rocrate"
```

---

## BagIt
---
The CLI supports creating BagIt from an existing RO-Crate. Integration of BagIt with repositories such as [Dataverse](https://guides.dataverse.org/en/5.13/user/dataset-management.html) and [Library of Congress](https://blogs.loc.gov/thesignal/2019/04/bagit-at-the-library-of-congress/) indicates its increasing use as a mechanism for transferring and storing digital content. The structure of a BagIt is simple to understand and the integrity of its contents can be easily validated. There is a clear separation of contents, metadata and checksum values.  

### Structure
A BagIt created by the CLI has the following structure that are described in detail in the [specification](https://datatracker.ietf.org/doc/html/rfc8493). By default, a BagIt created by the CLI contains `bag-info.txt` for metadata, `bag.txt` specifying the version and encoding, three files titled `manifest-[algorithm].txt` for validating digital contents, and three `tagmanifest-[algorithm].txt` files for validating the rest of the files in a `Bag` other than the contents. Each `algorithm` is an instance of the [MD5](https://en.wikipedia.org/wiki/MD5), SHA-256 and SHA-512 [hash algorithms](https://en.wikipedia.org/wiki/SHA-2) for generating checksum.

```
<base directory>/
   |
   +-- bag-info.txt
   |
   +-- bagit.txt
   |
   +-- manifest-md5.txt
   |
   +-- manifest-sha256.txt
   |
   +-- manifest-sha512.txt
   |
   +-- tagmanifest-md5.txt
   |
   +-- tagmanifest-sha256.txt 
   |
   +-- tagmanifest-sha512.txt 
   |
   +-- data/
   |     |
   |     +-- [payload files]
```

### Create BagIt
Creating a BagIt requires a user to submit information about the metadata, an exising RO-Crate location as `ROCRATE_PATH`, and the target location of the BagIt as `BAGIT_PATH`. The options below list all the six metadata keyword required to create a BagIt.  


``` bash
fairscape-cli rocrate package bagit [OPTIONS] ROCRATE_PATH BAGIT_PATH

Options:
  --Source-Organization TEXT   [required]
  --Organization-Address TEXT  [required]
  --Contact-Name TEXT          [required]
  --Contact-Phone TEXT         [required]
  --Contact-Email TEXT         [required]
  --External-Description TEXT  [required]
```

### Example
The following command creates a BagIt in `/path/to/test_bagit` form an existing RO-Crate in `/path/to/test_rocrate`.


``` bash
fairscape-cli rocrate package bagit \
   "/path/to/test_rocrate" \
   "/path/to/test_bagit" \
   --Source-Organization "FOO University" \
   --Organization-Address "1 Main St., Cupertino, California, 11111" \
   --Contact-Name "Jane Doe" \
   --Contact-Phone "+1 111-111-1111" \
   --Contact-Email "example@example.com" \
   --External-Description "Uncompressed greyscale TIFF images from the FOO papers colle..."
```